# 前言

欢迎来到 *Practical Ansible – 第二版*，这本书将指导您从一个初学者成长为熟练的 Ansible 自动化工程师，只需几个章节。这本书将为您提供执行首次安装和自动化任务所需的知识和技能，带领您从执行简单的单行自动化命令开始，这些命令能够完成单一任务，直到编写您自己的复杂自定义代码以扩展 Ansible 的功能，甚至自动化云和容器基础设施。在全书中，您将看到实际的示例，不仅仅是阅读关于 Ansible 自动化的内容，您还可以亲自实践并理解代码的工作原理。通过这些学习，您将能够使用 Ansible 自动化您的基础设施，并确保其具备可扩展性、可重复性和可靠性。

# 本书适合人群

本书适合任何有 IT 任务需要自动化的人，从日常琐碎的家务任务到复杂的基于基础设施即代码的部署。它旨在吸引那些有 Linux 环境经验的人，他们希望快速掌握 Ansible 自动化，并适合各类人员，包括系统管理员、DevOps 工程师、以及考虑整体自动化策略的架构师，甚至是爱好者。假设读者已经具备一定的 Linux 系统管理和维护基础，但无需提前具备 Ansible 或自动化经验。

# 本书内容

*第一章*，*开始使用 Ansible*，提供了您进行首次安装 Ansible 所需的步骤，并解释了如何快速上手并运行这种强大的自动化工具。

*第二章*，*理解 Ansible 的基础*，探讨了 Ansible 框架，帮助您深入理解 Ansible 语言的基础，并解释了如何使用其包含的各种命令行工具。

*第三章*，*定义您的库存*，为您提供了关于 Ansible 库存、其目的以及如何创建和使用自己的库存的详细信息。它还探讨了静态库存和动态库存之间的差异，以及在何时使用每种类型。

*第四章*，*Playbooks 和角色*，为您提供了如何以 playbooks 形式创建自己的 Ansible 自动化代码的深入介绍，以及如何通过角色实现该代码的有效重用。

*第五章*，*创建和使用* *模块*，向您介绍了 Ansible 模块及其用途，并为您提供了编写自己模块所需的步骤，甚至包括如何将其提交到 Ansible 项目中以供包含。

*第六章*，*创建与使用* *集合*，探讨了 Ansible Collections，涵盖了它们的设计、意图以及它们为什么对 Ansible 的未来至关重要。随后，我们将引导你如何创建和使用自己的集合，让你获得第一手经验。

*第七章*，*创建与使用* *插件*，解释了 Ansible 插件的用途，涵盖了 Ansible 使用的各种插件类型。然后解释了如何编写自己的插件，并说明如何将代码提交到 Ansible 项目。

*第八章*，*编码最佳实践*，深入探讨了你在编写 Ansible 自动化代码时应遵循的最佳实践，以确保你的解决方案可管理、易于维护和扩展。

*第九章*，*高级 Ansible 主题*，探讨了一些更高级的 Ansible 选项和语言指令，这些选项在执行大规模、高可用集群的部署时非常有价值。它还解释了如何通过跳板机在安全网络上自动化任务，以及如何加密静态的变量数据。

*第十章*，*使用 Ansible 进行网络自动化*，详细探讨了网络自动化的重要性，解释了为什么 Ansible 特别适合此任务，并通过实际示例向你展示如何使用 Ansible 连接到各种网络设备。

*第十一章*，*容器与云管理*，探讨了 Ansible 如何支持与云平台和容器平台的协同工作，并教授如何使用 Ansible 构建容器，以及如何在云环境中使用 Ansible 部署基础设施作为代码的方法。

*第十二章*，*故障排除与测试策略*，教你如何测试和调试你的 Ansible 代码，并为你提供强大的策略，以应对无论是 Playbook 还是 Ansible 依赖的无代理连接中的错误和意外失败。

*第十三章*，*Ansible 自动化控制器入门*，介绍了 Ansible 自动化控制器及其上游的开源版本 AWX，演示了这个强大工具如何为 Ansible 提供有价值的补充，尤其是在大型、多用户的企业环境中。

*第十四章*，*执行环境*，介绍了执行环境，演示了如何创建、共享它们，以及如何在命令行和 Ansible 自动化控制器中使用它们。

# 若想充分利用本书的内容

本书的所有章节假设你至少有一台运行较新版本 Linux 发行版的 Linux 机器。所有示例都在 Fedora 38 和 Ubuntu Server 22.04 上进行了测试，但也应该能在其他主流发行版上正常运行。你还需要在至少一台测试机器上安装 Ansible 2.15，安装步骤将在第一章中详细介绍。后续版本的 Ansible 也应该可以使用，尽管可能会有一些细微差别，若有不同，你应参考发行说明和迁移指南。最后两章还会介绍 AWX 的安装过程，但前提是你的 Linux 服务器已安装了 Ansible。本书的大多数示例演示了跨多个主机的自动化，如果你有更多的 Linux 主机可用，你将能从示例中获得更多的体验；不过，你也可以根据需要扩展或缩减规模。拥有更多主机并非强制性的，但它能帮助你更好地理解书中的内容。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| 至少一台 Linux 服务器（虚拟机或物理机）。 | Fedora 38 或 Ubuntu Server 22.04，尽管其他主流发行版（包括这些操作系统的更新版本）也应该能正常工作。 |
| Ansible 8.0 | 如上所述。 |
| AWX 版本 22.4.0 或更高版本 | 如上所述。 |

**如果你使用的是本书的数字版，建议你自己输入代码，或从本书的 GitHub 仓库访问代码（链接在下一节提供）。这样做可以帮助你避免与代码复制粘贴相关的潜在错误** **。**

# 下载示例代码文件

你可以从 GitHub 上下载本书的示例代码文件，链接为[`github.com/PacktPublishing/Practical-Ansible-Second-Edition`](https://github.com/PacktPublishing/Practical-Ansible-Second-Edition)。如果代码有更新，它将会在 GitHub 仓库中更新。

我们还提供了其他代码包，可以从我们丰富的书籍和视频目录中获取，访问链接：[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)。快去看看吧！

# 使用的约定

本书中使用了一些文本约定。

`文本中的代码`：表示文本中的代码词汇、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 用户名。例如：“第一个叫做`ansible-core`，它包含了 Ansible 的运行时代码（例如稍后我们会看到的`ansible-playbook`命令），以及一些内置的功能，这些功能是所有 playbook 和角色的核心。”

代码块如下所示：

```
  tasks:
  - name: Install/Update to the latest of Apache Web Server
    ansible.builtin.apt:
      name: apache2
      state: latest
```

当我们希望将你注意力集中到代码块的某个特定部分时，相关的行或项目将以粗体显示：

```
  handlers:
  - name: Restart the Apache Web Server
    ansible.builtin.service:
      name: apache2
      state: restarted
```

任何命令行输入或输出的格式如下：

```
$ python3 --version
Python 3.10.6
```

**粗体**：表示一个新术语、一个重要的词汇，或你在屏幕上看到的文字。例如，菜单或对话框中的词汇会显示为**粗体**。例如：“从**管理**面板中选择**系统信息**。”

提示或重要说明

显示如下。

# 与我们联系

我们始终欢迎读者的反馈。

**一般反馈**：如果你对本书的任何方面有疑问，请通过 customercare@packtpub.com 向我们发送电子邮件，并在邮件的主题中提及书名。

**勘误**：虽然我们已经尽力确保内容的准确性，但难免会有错误。如果你在本书中发现错误，我们将非常感激你能将其报告给我们。请访问 [www.packtpub.com/support/errata](https://www.packtpub.com/support/errata) 并填写表格。

**盗版**：如果你在互联网上发现我们作品的任何非法复制形式，我们将非常感激你能提供其位置或网站名称。请通过 copyright@packt.com 联系我们，并附上材料的链接。

**如果你有兴趣成为作者**：如果你在某个话题上具有专业知识，并且有兴趣撰写或参与书籍的创作，请访问 [authors.packtpub.com](https://authors.packtpub.com)。

# 分享你的想法

阅读完 *Practical Ansible - 第二版* 后，我们希望听到你的想法！请 [点击这里直接进入 Amazon 评论页面](https://packt.link/r/180512997X) 并分享你的反馈。

你的评价对我们和技术社区都非常重要，它将帮助我们确保提供优质的内容。

# 下载本书的免费 PDF 副本

感谢你购买本书！

你喜欢在路上阅读，但又无法随身携带纸质书籍吗？

你的电子书购买是否与你选择的设备不兼容？

不用担心，现在购买每本 Packt 书籍时，你都会免费获得该书的无 DRM PDF 版本。

在任何地方、任何设备上随时阅读。直接从你最喜欢的技术书籍中搜索、复制并粘贴代码到你的应用程序中。

好处还不止于此，你还可以独家获取折扣、时事通讯和每天发送到你邮箱的精彩免费内容。

按照以下简单步骤获得好处：

1.  扫描二维码或访问以下链接

![](img/B20846_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781805129974`](https://packt.link/free-ebook/9781805129974)

1.  提交你的购买证明

1.  就是这样！我们将直接把你的免费 PDF 和其他好处发送到你的邮箱。

# 第一部分：学习 Ansible 的基础知识

在本节中，我们将介绍 Ansible 的基础知识。我们将从安装 Ansible 的过程开始，然后学习基本概念，包括语言基础和临时命令。接着，我们将探索 Ansible 的清单，最后编写我们的第一个 playbooks 和角色，完成多阶段的自动化任务。

本节包含以下章节：

+   *第一章*，*Ansible 入门*

+   *第二章*，*理解 Ansible 的基础*

+   *第三章*，*定义您的清单*

+   *第四章*，*Playbooks 与角色*
