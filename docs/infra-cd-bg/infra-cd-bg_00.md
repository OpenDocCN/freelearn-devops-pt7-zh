# 前言

欢迎来到 *基础设施即代码入门*，这是一本帮助你通过代码管理和部署基础设施的指南。本书将为你提供在这个不断变化的领域中成功所需的核心概念、工具和技术的坚实基础。

在各个章节中，你将获得与流行的基础设施即代码工具（如 Terraform 和 Ansible）的实践经验，学习如何规划和部署资源到领先的公共云供应商（如 Microsoft Azure 和 Amazon Web Services），并深入探讨最佳实践和故障排除策略，帮助你克服挑战并优化你的部署。

随着你深入阅读本书，你将探讨**持续集成**和**持续部署**（**CI/CD**）在使用 GitHub Actions 自动化基础设施即代码项目中的作用。你将学习如何利用 CI/CD 创建一致且可靠的部署，并实施安全实践来保护你的部署。

此外，你将通过探索 Pulumi、Azure Bicep 和 AWS CloudFormation 等替代工具，扩展你的基础设施即代码工具集，从而增强对特定供应商和云中立选项的理解。

在这段学习旅程结束时，你将获得规划、构建、部署和管理你的基础设施即代码项目的知识和信心，使你能够创建高效、可扩展和可靠的基础设施解决方案，支持你的项目和职业生涯多年。

# 本书适合谁阅读

本书专为那些有手动部署资源经验以托管应用程序的开发人员和系统管理员量身定制，他们现在希望通过自动化创建和管理基础设施及应用程序，提升自己的技能。

本书将赋能那些有大量手动部署和配置资源经验的读者，他们现在希望简化流程，提高效率和一致性，并将基础设施即代码集成到他们的日常工作流程中。

# 本书涵盖的内容

在 *第一章**，《选择正确的方法—声明式还是命令式》* 中，我们介绍了基础设施即代码的基本概念，讨论了手动基础设施管理的挑战、声明式与命令式方法的区别，以及 *宠物与牲畜* 的类比，为理解其在现代部署中的重要性奠定了基础。

在 *第二章**，《超越文档的 Ansible 和 Terraform》* 中，我们深入探讨 HashiCorp 提供的基础设施即代码工具 Terraform 和 Red Hat 提供的配置管理工具 Ansible。我们将讨论工具选择标准，介绍 Terraform 和 Ansible，并提供一些关于使用 Visual Studio Code 作为编写代码的 IDE 的指南，包括一些推荐的扩展。

在*第三章**，部署规划，我们* 强调在基础设施即代码（Infrastructure-as-Code）部署中规划的重要性。你将了解将要部署的工作负载，学习部署方法，并探索一个逐步指南，以实现高效、无错误的执行。我们还将审视高层次的基础设施架构，为即将到来的 Azure 和 AWS 部署做准备。

在*第四章**，部署到微软 Azure，我们* 探讨如何将我们的项目部署到微软 Azure，这是本书中介绍的两个主要公共云提供商之一。主题包括介绍 Azure、准备云环境、创建低级设计，并使用 Terraform 和 Ansible 编写和部署基础设施代码。

在*第五章**，部署到亚马逊 Web 服务，我们* 继续将项目部署到**亚马逊 Web 服务**（**AWS**），并突出 Azure 和 AWS 之间的主要区别。我们将深入探讨 Ansible 的部署，并了解如何使用 Ansible 和 Terraform 来管理 AWS 资源。到本章结束时，你将了解如何调整你的部署方法，以适应不同的云提供商。

在*第六章**，构建基础，深入探讨* 如何使用像 Terraform 和 Ansible 这样的云无关工具，在不同的公共云提供商之间部署高层设计的细节。我们将分享我在解决提供商之间差异时的经验，探索创建可重复部署过程的实际方法，并着眼于模块化代码的重要性，以实现简化部署工作和代码重用。

*在* *第七章**，在云中利用 CI/CD，我们* 将专注于使用 CI/CD 来自动化基础设施部署。我们将探索流行的 CI/CD 工具 GitHub Actions，并学习如何使用它来运行 Azure 和 AWS 的 Terraform 和 Ansible 代码。

*在* *第八章**，常见的故障排除技巧和最佳实践，我们* 将学习规划、编写和故障排除基础设施即代码项目的基本策略。本章涵盖了基础设施即代码的一般最佳实践和故障排除技巧，并为 Terraform 和 Ansible 提供了具体指导。通过了解每个工具的独特挑战，你将更好地准备应对在基础设施即代码旅程中可能遇到的障碍。

*在* *第九章**，《探索替代基础设施即代码工具》中，我们将通过探索三个额外的工具：Pulumi、Azure Bicep 和 AWS CloudFormation，来扩展我们的基础设施即代码工具集。本章旨在提供这些工具的实践理解和知识，突出展示云中立工具与供应商特定工具之间的差异，并展示 Pulumi 使用熟悉的编程语言的独特方法。*

# 为了从本书中获得最大收获

在开始之前，你应该了解如何接近并部署基础设施，以支持你现有的一个或多个应用程序。理想情况下，这些基础设施应托管在 Microsoft Azure 或 Amazon Web Services 上。

虽然这是可选的，但本书假设你对 Microsoft Azure 或 Amazon Web Services 以及一些核心服务的基本概念（如网络或虚拟机）有基本了解。虽然这不是必需的，但在一些更具实践性的章节中，你可能需要进一步阅读我们为何以某种方式处理任务。

我们还假设你希望跟随一些更具实践性的章节；因此，拥有或访问一个不用于托管生产资源的 Microsoft Azure 或 Amazon Web Services 账户将是一个加分项。

| **书中涉及的软件/硬件** | **操作系统要求** |
| --- | --- |
| Terraform | Windows、macOS 或 Linux |
| Ansible | Windows、macOS 或 Linux |
| Microsoft Azure CLI 和门户 | Windows、macOS 或 Linux |
| Amazon Web Services CLI 和门户 | Windows、macOS 或 Linux |
| Pulumi | Windows、macOS 或 Linux |
| Visual Studio Code | Windows、macOS 或 Linux |

每个工具的安装说明链接都可以在各章节的进一步阅读部分找到。

**如果你使用的是本书的数字版本，我们建议你自己输入代码或从书籍的 GitHub 仓库访问代码（链接在下一部分提供）。这样做可以帮助你避免与代码复制粘贴相关的潜在错误。**

最后，随意尝试；查看本书附带的代码并进行修改。然而，注意控制开支，并始终确保在完成后终止任何已部署的资源，以避免任何意外和不必要的费用。

# 下载示例代码文件

你可以从 GitHub 下载本书的示例代码文件，地址为 [`github.com/PacktPublishing/Infrastructure-as-Code-for-Beginners`](https://github.com/PacktPublishing/Infrastructure-as-Code-for-Beginners)。如果代码有更新，它将会在 GitHub 仓库中进行更新。

我们还提供了其他代码包，来自我们丰富的书籍和视频目录，地址为 [`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)。快去看看吧！

# 下载彩色图片

我们还提供了一个 PDF 文件，其中包含本书中使用的截图和图表的彩色版本。你可以在此下载：[`packt.link/uvP61`](https://packt.link/uvP61)。

# 使用的约定

本书中使用了许多文本约定。

`文本中的代码`：表示文本中的代码字、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 用户名。以下是一个例子：“前三行，`name`、`runtime`和`description`，定义了关于我们的部署的一些基本元信息。”

一段代码格式如下所示：

```
name: pulumi-yaml
runtime: yaml
description: A minimal Azure Native Pulumi YAML program
outputs:
  primaryStorageKey: ${storageAccountKeys.keys[0].value}
```

任何命令行输入或输出格式如下所示：

```
$ pulumi up -c Pulumi.dev.yaml
```

**粗体**：表示新术语、重要词汇或在屏幕上出现的词汇。例如，在菜单或对话框中的词汇会以**粗体**显示。以下是一个例子：“最后一步是查看你的堆栈，点击**提交**按钮，从而触发堆栈创建。”

提示或重要说明

显示格式如下：

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果你对本书的任何方面有疑问，请通过 customercare@packtpub.com 给我们发邮件，并在邮件主题中提及书名。

**勘误表**：尽管我们已尽最大努力确保内容的准确性，但错误仍然可能发生。如果你在本书中发现错误，我们将非常感激你向我们报告。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果你在互联网上发现任何非法复制的我们作品的形式，我们将非常感激你向我们提供位置地址或网站名称。请通过版权邮箱联系我们，并附上相关内容的链接。

**如果你有兴趣成为作者**：如果你在某个领域具有专业知识，并且有兴趣编写或参与书籍的创作，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享你的想法

阅读完*《基础设施即代码入门》*后，我们很想听听你的想法！请[点击这里直接进入亚马逊评论页面](https://packt.link/r/1837631638)，分享你的反馈。

你的反馈对我们以及技术社区都很重要，将帮助我们确保提供优质的内容。

# 下载本书的免费 PDF 副本

感谢购买本书！

你喜欢随时阅读但又无法随身携带纸质书籍吗？你购买的电子书是否无法在你选择的设备上使用？

不用担心，现在购买任何 Packt 书籍，你都会免费获得该书的无 DRM 保护 PDF 版本。

随时随地，任何设备上都可以阅读。你可以搜索、复制并将代码从你喜欢的技术书籍直接粘贴到你的应用程序中。

好处不仅如此，您还可以独家享受折扣、新闻通讯以及每日送达的优质免费内容

按照以下简单步骤获得福利：

1.  扫描二维码或访问以下链接

![](img/B19537_QR_Free_PDF.jpg)

[`packt.link/free-ebook/978-1-83763-163-6`](https://packt.link/free-ebook/978-1-83763-163-6)

1.  提交您的购买凭证

1.  就这样！我们将直接把您的免费 PDF 和其他福利发送到您的电子邮件

# 第一部分：基础 – 基础设施即代码简介

在本部分中，我们将讨论如何使用我自己的经历作为起点来开始您的基础设施即代码之旅，然后探讨基础设施即代码的一些核心原则。

我们还将查看我们用于部署示例工作负载的工具，并规划工作负载本身的部署。

本部分包含以下章节：

+   *第一章*，*选择正确的方法 – 声明式还是命令式*

+   *第二章*，*超越文档的 Ansible 和 Terraform*

+   *第三章*，*规划部署*
